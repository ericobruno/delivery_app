<!DOCTYPE html>
<html>
<head>
    <title>Teste Aceite Automático</title>
    <meta name="csrf-token" content="test-token">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="http://localhost:3001/assets/application.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Teste do Botão de Aceite Automático</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm" style="max-width: 300px;">
                    <div class="card-body text-center">
                        <div class="d-flex align-items-center justify-content-center mb-3">
                            <i class="fas fa-toggle-off text-success me-2 fs-4"></i>
                            <span class="badge bg-success bg-opacity-10 text-success">OFF</span>
                        </div>
                        
                        <div data-controller="aceite-automatico" 
                             data-aceite-automatico-status-value="false"
                             data-aceite-automatico-url-value="/admin/toggle_aceite_automatico">
                            
                            <button data-aceite-automatico-target="button" 
                                    data-action="click->aceite-automatico#toggle"
                                    class="btn btn-outline-success btn-lg w-100 position-relative">
                                
                                <span class="button-text">
                                    Ativar Aceite Automático
                                </span>
                                
                                <div class="spinner-border spinner-border-sm d-none" role="status">
                                    <span class="visually-hidden">Carregando...</span>
                                </div>
                            </button>
                        </div>
                        
                        <small class="text-muted mt-2 d-block">
                            Pedidos precisam de aprovação manual
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Debug Info</h5>
                    </div>
                    <div class="card-body">
                        <div id="debug-info">
                            <p><strong>Status:</strong> <span id="status">OFF</span></p>
                            <p><strong>Controller:</strong> <span id="controller-status">Carregando...</span></p>
                            <p><strong>Elementos:</strong> <span id="elements-status">Verificando...</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        console.log('Página carregada');
        console.log('Stimulus disponível:', typeof Stimulus !== 'undefined');
        console.log('Turbo disponível:', typeof Turbo !== 'undefined');
        
        // Debug info
        setTimeout(() => {
            const controller = document.querySelector('[data-controller="aceite-automatico"]');
            const button = document.querySelector('[data-aceite-automatico-target="button"]');
            const statusSpan = document.getElementById('status');
            const controllerSpan = document.getElementById('controller-status');
            const elementsSpan = document.getElementById('elements-status');
            
            if (controller) {
                controllerSpan.textContent = '✅ Controller encontrado';
                console.log('Controller encontrado:', controller);
            } else {
                controllerSpan.textContent = '❌ Controller não encontrado';
            }
            
            if (button) {
                elementsSpan.textContent = '✅ Botão encontrado';
                console.log('Botão encontrado:', button);
            } else {
                elementsSpan.textContent = '❌ Botão não encontrado';
            }
            
            // Simular mudança de status
            button.addEventListener('click', () => {
                const currentStatus = statusSpan.textContent;
                const newStatus = currentStatus === 'OFF' ? 'ON' : 'OFF';
                statusSpan.textContent = newStatus;
                console.log('Status mudou para:', newStatus);
            });
        }, 1000);
    </script>
</body>
</html>