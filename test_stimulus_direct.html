<!DOCTYPE html>
<html>
<head>
    <title>Teste Stimulus Direto</title>
    <meta name="csrf-token" content="test-token">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@hotwired/stimulus@3.2.2/dist/stimulus.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Teste Stimulus Direto</h1>
        
        <div data-controller="aceite-automatico" 
             data-aceite-automatico-status-value="false"
             data-aceite-automatico-url-value="/admin/toggle_aceite_automatico">
            
            <button data-aceite-automatico-target="button" 
                    data-action="click->aceite-automatico#toggle"
                    class="btn btn-primary">
                Teste Bot√£o
            </button>
        </div>
        
        <div class="mt-3">
            <h3>Debug Info:</h3>
            <div id="debug"></div>
        </div>
    </div>
    
    <script>
        // Definir controller diretamente
        const application = Stimulus.Application.start()
        
        application.register("aceite-automatico", class extends Stimulus.Controller {
            static values = { 
                status: Boolean,
                url: String
            }
            
            static targets = ["button"]
            
            initialize() {
                console.log('üéØ Aceite Autom√°tico Controller inicializado');
            }
            
            connect() {
                console.log('üéØ Aceite Autom√°tico Controller conectado');
                console.log('üìä Status inicial:', this.statusValue);
                console.log('üîó URL:', this.urlValue);
                console.log('üîç Elemento:', this.element);
                console.log('üéØ Bot√£o target:', this.buttonTarget);
            }
            
            toggle(event) {
                event.preventDefault();
                event.stopPropagation();
                
                console.log('üîÑ Toggle iniciado');
                console.log('üîç Evento:', event);
                console.log('üéØ Bot√£o clicado:', this.buttonTarget);
                
                // Teste simples - apenas mostrar alerta
                alert('Bot√£o clicado! Status atual: ' + this.statusValue);
                
                // Confirma√ß√£o simples
                const newStatus = !this.statusValue;
                const actionText = newStatus ? 'ATIVAR' : 'DESATIVAR';
                
                if (!confirm(`Confirma ${actionText} o aceite autom√°tico?`)) {
                    console.log('‚ùå Usu√°rio cancelou');
                    return;
                }
                
                console.log('‚úÖ Usu√°rio confirmou');
                
                // Atualizar estado
                this.statusValue = newStatus;
                this.updateButton(newStatus);
                alert('Status alterado para: ' + (newStatus ? 'ON' : 'OFF'));
            }
            
            updateButton(status) {
                console.log('üé® Atualizando bot√£o para status:', status);
                
                const buttonText = this.buttonTarget.querySelector('.button-text');
                
                // Atualizar classes do bot√£o
                this.buttonTarget.classList.remove('btn-outline-success', 'btn-outline-danger');
                this.buttonTarget.classList.add(status ? 'btn-outline-danger' : 'btn-outline-success');
                
                // Atualizar texto
                if (buttonText) {
                    buttonText.textContent = status ? 'Desativar Aceite Autom√°tico' : 'Ativar Aceite Autom√°tico';
                }
                
                console.log('‚úÖ Bot√£o atualizado');
            }
        });
        
        // Verificar se Stimulus est√° dispon√≠vel
        console.log('Stimulus dispon√≠vel:', typeof Stimulus !== 'undefined');
        console.log('Application criada:', application);
        
        // Adicionar debug info
        setTimeout(() => {
            const debug = document.getElementById('debug');
            debug.innerHTML = `
                <p><strong>Stimulus:</strong> ${typeof Stimulus !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√£o carregado'}</p>
                <p><strong>Application:</strong> ${application ? '‚úÖ Criada' : '‚ùå N√£o criada'}</p>
                <p><strong>Controller:</strong> <span id="controller-status">Verificando...</span></p>
                <p><strong>Bot√£o:</strong> <span id="button-status">Verificando...</span></p>
            `;
            
            const controller = document.querySelector('[data-controller="aceite-automatico"]');
            const button = document.querySelector('[data-aceite-automatico-target="button"]');
            
            document.getElementById('controller-status').textContent = 
                controller ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado';
            
            document.getElementById('button-status').textContent = 
                button ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado';
                
            if (controller) {
                console.log('Controller encontrado:', controller);
                console.log('Data attributes:', controller.dataset);
            }
            
            if (button) {
                console.log('Bot√£o encontrado:', button);
                console.log('Data action:', button.dataset.action);
            }
        }, 1000);
    </script>
</body>
</html>